#!/bin/bash

# Original Maintainer: SÃ©bastien Luttringer

# Maintainer: manuel (see forum.endeavouros.com)

pkgname=virtualbox-ext-oracle
pkgdesc='Oracle VM VirtualBox Extension Pack (https://www.virtualbox.org)'
url="https://github.com/manuel-192/m-maur/raw/master/PKGBUILDs/$pkgname"
pkgver=6.1.14
pkgrel=1
arch=('any')
license=('custom:PUEL')
depends=(virtualbox)
depends=("virtualbox")
optdepends=('rdesktop: client to connect vm via RDP')
options=('!strip')
_filename="Oracle_VM_VirtualBox_Extension_Pack-${pkgver}.vbox-extpack"
noextract=("$_filename")
install=virtualbox-ext-oracle.install

source=(
    "https://download.virtualbox.org/virtualbox/${pkgver}/$_filename"
    "$url/$install"
)
sha512sums=('436ed94cec32365b9b19fe170323519543d18fcdad28eac09438c2238d68e452b25a415d69f244fd26b4c117fc5e2b33c8bd2fb63b31805f62ed9d59500eb304'
            'b6650f030c42f0471ec24137e934cc288aff9d6fe28cdfaa3bcd37b8148c6e25cb4c4e5dbc95241b7bf00280d57e1c6d1700821df7ff2bc72bfa61b536968003')

prepare() {
  # shrink uneeded cpuarch
  [[ -d shrunk ]] || mkdir shrunk
  tar xfC "$_filename" shrunk
  rm -r shrunk/{darwin*,solaris*,win*}
  tar -c --gzip --file shrunk.vbox-extpack -C shrunk .
}

package() {
  install -Dm644 shrunk.vbox-extpack        "$pkgdir/usr/share/virtualbox/extensions/$_filename"
  install -Dm644 shrunk/ExtPack-license.txt "$pkgdir/usr/share/licenses/$pkgname/PUEL"
}
