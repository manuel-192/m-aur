#!/bin/bash

_os-prober_prepare() {

    # Use Manjaro's os-prober source code and change
    # - source code address at debian to use https instead of http
    # - checksums because of different .gitignore files!
    # - pkgname to os-prober-manjaro
    # - to provide os-prober "service"
    
    git clone https://gitlab.manjaro.org/packages/community/os-prober.git 2>/dev/null || return 1

    mv os-prober/PKGBUILD os-prober/PKGBUILD.orig

    local Pkgver=$(grep ^pkgver= os-prober/PKGBUILD.orig | cut -d'='  -f2)
    sed -i os-prober/PKGBUILD.orig \
        -e 's|pkgname|_pkgname|g' \
        -e 's|cd "$_pkgname"|cd "$_pkgname"-"$pkgver"|' \
        -e '/^package()/a \  rm -f ../*.patch ../*.diff ../*.gz ../*.orig'

    mv os-prober/* .
    rm -rf os-prober
    source PKGBUILD.orig

    pkgname=os-prober-manjaro
    provides=(os-prober)
    conflicts=(os-prober)
    replaces=(os-prober)
}

_os-prober_prepare
unset -f _os-prober_prepare
